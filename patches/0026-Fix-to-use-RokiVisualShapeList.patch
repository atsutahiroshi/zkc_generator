From b89d4db6f7b96d46e6280b54c664472912c1d845 Mon Sep 17 00:00:00 2001
From: Hiroshi Atsuta <atsuta.hiroshi@gmail.com>
Date: Wed, 11 Oct 2017 19:18:39 +0200
Subject: [PATCH 26/41] Fix to use RokiVisualShapeList

---
 src/RokiPlugin/RokiSimulatorItem.cpp | 12 +++++-------
 1 file changed, 5 insertions(+), 7 deletions(-)

diff --git a/src/RokiPlugin/RokiSimulatorItem.cpp b/src/RokiPlugin/RokiSimulatorItem.cpp
index e56a593..8dde073 100644
--- a/src/RokiPlugin/RokiSimulatorItem.cpp
+++ b/src/RokiPlugin/RokiSimulatorItem.cpp
@@ -1545,17 +1545,15 @@ void RokiBody::exportAsZkcFile(const std::string& filename)
     }
 
     // find all shapes
-    RokiShapeList shapeList;
+    RokiVisualShapeList shapeList;
     findAllShape(shapeList);
     zArrayAlloc(&rkChainShape(chain)->shape, zShape3D, shapeList.num());
     for(int i=0; i<shapeList.num(); ++i){
         zShape3D *target = zMShape3DShape(rkChainShape(chain), i);
-        zOpticalInfo *oarray = rkChainShape(chain)->optic.buf;
-        zOpticalInfo *opt;
-        string optName = shapeList.getOpticName(shapeList.get(i));
-        zNameFind(oarray, opticList.num(),
-                  const_cast<char*>(optName.c_str()), opt);
-        zShape3DClone(shapeList.get(i), target, opt);
+        const zOpticalInfo *opt = \
+            opticList.findByOpticName(shapeList.get(i).getOpticName()).get();
+        zShape3DClone(shapeList.get(i).get(), target,
+                      const_cast<zOpticalInfo*>(opt));
     }
 
     // export
-- 
2.7.4

